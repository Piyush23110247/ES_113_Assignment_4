<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Partywise distribution for donation of a company</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <link rel="stylesheet" href="http://cdn.datatables.net/1.10.25/css/dataTables.bootstrap4.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
</head>
<body>
    <div class="container my-5">
        <h1 class="mb-4">Partywise distribution for donations</h1>

        <table id="partyTable" class="table table-striped table-bordered">
            <thead>
                <tr>
                    <th>Number of Bonds</th>
                    <th>Bond Values (in Cr)</th>
                    <th>Name of Political Party</th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>

        <p id="totalAmount" class="mt-4"></p>
        
        <canvas id="partyChart"></canvas>
    </div>

    <script src="http://cdn.datatables.net/1.10.25/js/jquery.dataTables.min.js"></script>
    <script src="http://cdn.datatables.net/1.10.25/js/dataTables.bootstrap4.min.js"></script>

    <script>
        $(document).ready(function() {
            fetchPartyData();
        });

        function fetchPartyData() {
            fetch('/party_bonds_data6', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({})
            })
            .then(response => response.json())
            .then(data => {
                if (data.error) {
                    console.error('Error:', data.error);
                    alert('Error fetching data. Please try again later.');
                } else {
                    renderPartyTable(data);
                    renderPartyChart(data);
                    displayTotalAmount(data);
                }
            });
        }

        function renderPartyTable(data) {
            $('#partyTable').DataTable({
                data: data,
                columns: [
                    { data: 0 },
                    { data: 1,
                      render: function(data, type, row) {
                          return 'â‚¹ ' + data + ' Cr';
                      }
                    },
                    { data: 2 }
                ]
            });
        }

        function renderPartyChart(data) {
            const partyNames = data.map(item => item[2]);
            const bondValues = data.map(item => item[1]);
            const ctx = document.getElementById('partyChart').getContext('2d');

            new Chart(ctx, {
                type: 'pie',
                data: {
                    labels: partyNames,
                    datasets: [{
                        label: 'Bond Values (in Cr)',
                        data: bondValues,
                        backgroundColor: [
                            'rgba(220, 53, 69, 0.8)', 
                            'rgba(40, 167, 69, 0.8)', 
                            'rgba(0, 123, 255, 0.8)', 
                            'rgba(255, 193, 7, 0.8)', 
                            'rgba(108, 117, 125, 0.8)', 
                            'rgba(173, 20, 87, 0.8)' 
                        ],
                        borderColor: 'white',
                        borderWidth: 1
                    }]
                }
            });
        }

        function displayTotalAmount(data) {
            const totalAmount = data.reduce((acc, item) => acc + parseFloat(item[1]), 0);
            document.getElementById('totalAmount').innerText = `Total amount received by all parties: ${totalAmount.toFixed(2)} Cr`;
        }
    </script>
</body>
</html>
